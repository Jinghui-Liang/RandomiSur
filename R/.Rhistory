} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE))
}
# split out questionnaire part
quest <- dat[, c("question", "q_choices", "q_required")]
colnames(quest)[colnames(quest) == "question"] <- "prompt"
colnames(quest)[colnames(quest) == "q_choices"] <- "choices"
if (!all(quest$q_required %in% c('y', 'n'))) {
stop ("Column q_required not properly defined.")
}
if (!is.na(quest$choices[1])) {
if (sum (is.na(quest$choices)) == 0) {
quest_js <- quest |>
dplyr::mutate (choices = purrr::map(quest$choices,
\(.x) unlist (strsplit(.x, split = "/"))))
} else if (sum (is.na(quest$choices)) == length (quest$choices) - 1) {
quest_js <- quest |>
dplyr::mutate (choices = strsplit(quest$choices[1], split = "/"))
} else {
stop ('Column "q_hoices" not properly defined.')
}
}
scaleJSON <- jsonlite::toJSON(quest_js, pretty = TRUE)
# split out demographic part
demo <- dat[, c("demo_var", "d_question", "d_choices", "d_required")] |>
dplyr::filter(demo_var != "NA")
colnames(demo)[colnames(demo) == "d_question"] <- "prompt"
colnames(demo)[colnames(demo) == "d_choices"] <- "choices"
demo_strvar <- demo |>
dplyr::filter (is.na(demo$choices)) |>
dplyr::mutate (choices = list (NA))
demo_catvar <- demo |>
dplyr::filter (!is.na(choices)) |>
dplyr::mutate (choices = purrr::map(choices,
\(.x) unlist (strsplit(.x, split = "/"))))
demo_js <- dplyr::bind_rows(demo_strvar, demo_catvar)
demoJSON <- jsonlite::toJSON(demo_js, pretty = TRUE)
write(scaleJSON, "./server/www/scale.json")
if (interactive()) {
dat <- tibble::as_tibble (read.csv (
'../scalepool/fullScale.csv',
header = TRUE,
na.strings = ""
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE))
}
# split out questionnaire part
quest <- dat[, c("question", "q_choices", "q_required")]
colnames(quest)[colnames(quest) == "question"] <- "prompt"
colnames(quest)[colnames(quest) == "q_choices"] <- "choices"
if (!all(quest$q_required %in% c('y', 'n'))) {
stop ("Column q_required not properly defined.")
}
if (!is.na(quest$choices[1])) {
if (sum (is.na(quest$choices)) == 0) {
quest_js <- quest |>
dplyr::mutate (choices = purrr::map(quest$choices,
\(.x) unlist (strsplit(.x, split = "/"))))
} else if (sum (is.na(quest$choices)) == length (quest$choices) - 1) {
quest_js <- quest |>
dplyr::mutate (choices = strsplit(quest$choices[1], split = "/"))
} else {
stop ('Column "q_hoices" not properly defined.')
}
}
scaleJSON <- jsonlite::toJSON(quest_js, pretty = TRUE)
# split out demographic part
demo <- dat[, c("demo_var", "d_question", "d_choices", "d_required")] |>
dplyr::filter(demo_var != "NA")
colnames(demo)[colnames(demo) == "d_question"] <- "prompt"
colnames(demo)[colnames(demo) == "d_choices"] <- "choices"
demo_strvar <- demo |>
dplyr::filter (is.na(demo$choices)) |>
dplyr::mutate (choices = list (NA))
demo_catvar <- demo |>
dplyr::filter (!is.na(choices)) |>
dplyr::mutate (choices = purrr::map(choices,
\(.x) unlist (strsplit(.x, split = "/"))))
demo_js <- dplyr::bind_rows(demo_strvar, demo_catvar)
demoJSON <- jsonlite::toJSON(demo_js, pretty = TRUE)
write(scaleJSON, "../server/www/scale.json")
write(demoJSON, "../server/www/demo.json")
if (interactive()) {
dat <- tibble::as_tibble (read.csv (
'../scalepool/fullScale.csv',
header = TRUE,
na.strings = ""
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE))
}
# split out questionnaire part
quest <- dat[, c("question", "q_choices", "q_required")]
colnames(quest)[colnames(quest) == "question"] <- "prompt"
colnames(quest)[colnames(quest) == "q_choices"] <- "choices"
(any(quest$q_required != "y" & quest$q_required != "n"))
(any(quest$q_required != "y" & quest$q_required != "n"))
(any(quest$q_required != "y" & quest$q_required != "n"))
any(quest$q_required != "y" & quest$q_required != "n") != NA)
any(quest$q_required != "y" & quest$q_required != "n") != NA
if (!is.na(any(quest$q_required != "y" & quest$q_required != "n"))) {
stop ("Column q_required not properly defined.")
}
View(dat)
View(quest)
View(dat)
View(quest)
if (interactive()) {
dat <- tibble::as_tibble (read.csv (
'../scalepool/fullScale.csv',
header = TRUE,
na.strings = ""
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE))
}
# split out questionnaire part
quest <- dat[, c("question", "q_choices", "q_required")] |>
dplyr::filter(question != "NA")
colnames(quest)[colnames(quest) == "question"] <- "prompt"
colnames(quest)[colnames(quest) == "q_choices"] <- "choices"
View(quest)
if (interactive()) {
dat <- tibble::as_tibble (read.csv (
'../scalepool/fullScale.csv',
header = TRUE,
na.strings = ""
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE))
}
# split out questionnaire part
quest <- dat[, c("question", "q_choices", "q_required")] |>
dplyr::filter(question != "NA")
colnames(quest)[colnames(quest) == "question"] <- "prompt"
colnames(quest)[colnames(quest) == "q_choices"] <- "choices"
View(dat)
View(quest)
View(dat)
View(quest)
View(dat)
View(quest)
any(quest$q_required != "y" || quest$q_required != "n"))
any(quest$q_required != "y" || quest$q_required != "n")
any(quest$q_required != "y" | quest$q_required != "n")
any(quest$q_required != "y" & quest$q_required != "n")
test <- c("x", "y", "n")
any(test != "y" & test != "n")
test <- c("x", "y")
any(test != "y" & test != "n")
test <- c("y", "n")
any(test != "y" & test != "n")
test <- c(n")
test <- c("n")
any(test != "y" & test != "n")
test <- c("y")
any(test != "y" & test != "n")
if (interactive()) {
dat <- tibble::as_tibble (read.csv (
'../scalepool/fullScale.csv',
header = TRUE,
na.strings = ""
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE),
na.strings = "")
}
# split out questionnaire part
quest <- dat[, c("question", "q_choices", "q_required")] |>
dplyr::filter(question != NA)
# split out questionnaire part
quest <- dat[, c("question", "q_choices", "q_required")] |>
dplyr::filter(!is.na(question != NA))
quest <- dat[, c("question", "q_choices", "q_required")]
# split out questionnaire part
quest <- dat[, c("question", "q_choices", "q_required")] |>
dplyr::filter(!is.na(question))
if (interactive()) {
dat <- tibble::as_tibble (read.csv (
'../scalepool/fullScale.csv',
header = TRUE,
na.strings = ""
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE),
na.strings = "")
}
# split out questionnaire part
quest <- dat[, c("question", "q_choices", "q_required")] |>
dplyr::filter(!is.na(question))
colnames(quest)[colnames(quest) == "question"] <- "prompt"
colnames(quest)[colnames(quest) == "q_choices"] <- "choices"
if (interactive()) {
dat <- tibble::as_tibble (read.csv (
'../scalepool/fullScale.csv',
header = TRUE,
na.strings = ""
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE),
na.strings = "")
}
# split out questionnaire part
quest <- dat[, c("question", "q_choices", "q_required")] |>
dplyr::filter(!is.na(question))
colnames(quest)[colnames(quest) == "question"] <- "prompt"
colnames(quest)[colnames(quest) == "q_choices"] <- "choices"
library (tidyverse)
glimpse (quest)
?read.csv
if (interactive()) {
dat <- tibble::as_tibble (read.csv (
'../scalepool/fullScale.csv',
header = TRUE,
na.strings = "",
fill = FALSE
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE,
fill = FALSE,
na.strings = ""))
}
if (interactive()) {
dat <- tibble::as_tibble (read.csv (
'../scalepool/fullScale.csv',
header = TRUE,
na.strings = "",
fill = FALSE
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE,
fill = FALSE,
na.strings = ""))
}
# split out questionnaire part
quest <- dat[, c("question", "q_choices", "q_required")] |>
dplyr::filter(!is.na(question)) |> tibble::as_tibble()
colnames(quest)[colnames(quest) == "question"] <- "prompt"
colnames(quest)[colnames(quest) == "q_choices"] <- "choices"
if (any(quest$q_required != "y" & quest$q_required != "n")) {
print (quest$q_required)
stop ("Column q_required not properly defined.")
}
if (!is.na(quest$choices[1])) {
if (sum (is.na(quest$choices)) == 0) {
quest_js <- quest |>
dplyr::mutate (choices = purrr::map(quest$choices,
\(.x) unlist (strsplit(.x, split = "/"))))
} else if (sum (is.na(quest$choices)) == length (quest$choices) - 1) {
quest_js <- quest |>
dplyr::mutate (choices = strsplit(quest$choices[1], split = "/"))
} else {
stop ('Column "q_choices" not properly defined.')
}
}
scaleJSON <- jsonlite::toJSON(quest_js, pretty = TRUE)
# split out demographic part
demo <- dat[, c("demo_var", "d_question", "d_choices", "d_required")] |>
dplyr::filter(demo_var != "NA")
colnames(demo)[colnames(demo) == "d_question"] <- "prompt"
colnames(demo)[colnames(demo) == "d_choices"] <- "choices"
demo_strvar <- demo |>
dplyr::filter (is.na(demo$choices)) |>
dplyr::mutate (choices = list (NA))
demo_catvar <- demo |>
dplyr::filter (!is.na(choices)) |>
dplyr::mutate (choices = purrr::map(choices,
\(.x) unlist (strsplit(.x, split = "/"))))
demo_js <- dplyr::bind_rows(demo_strvar, demo_catvar)
demoJSON <- jsonlite::toJSON(demo_js, pretty = TRUE)
scaleJSON
demoJSON
View(quest)
View(demo_js)
if (interactive()) {
dat <- tibble::as_tibble (read.csv (
'../scalepool/fullScale.csv',
header = TRUE,
na.strings = "",
fill = FALSE
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE,
fill = FALSE,
na.strings = ""))
}
# split out questionnaire part
quest <- dat[, c("question", "q_choices", "q_required")] |>
dplyr::filter(!is.na(question)) |> tibble::as_tibble()
colnames(quest)[colnames(quest) == "question"] <- "prompt"
colnames(quest)[colnames(quest) == "q_choices"] <- "choices"
if (any(quest$q_required != "y" & quest$q_required != "n")) {
print (quest$q_required)
stop ("Column q_required not properly defined.")
}
if (!is.na(quest$choices[1])) {
if (sum (is.na(quest$choices)) == 0) {
quest_js <- quest |>
dplyr::mutate (choices = purrr::map(quest$choices,
\(.x) unlist (strsplit(.x, split = "/"))))
} else if (sum (is.na(quest$choices)) == length (quest$choices) - 1) {
quest_js <- quest |>
dplyr::mutate (choices = strsplit(quest$choices[1], split = "/"))
} else {
stop ('Column "q_choices" not properly defined.')
}
}
scaleJSON <- jsonlite::toJSON(quest_js, pretty = TRUE)
# split out demographic part
demo <- dat[, c("demo_var", "d_question", "d_choices", "d_required")] |>
dplyr::filter(demo_var != "NA")
colnames(demo)[colnames(demo) == "d_question"] <- "prompt"
colnames(demo)[colnames(demo) == "d_choices"] <- "choices"
demo_strvar <- demo |>
dplyr::filter (is.na(demo$choices)) |>
dplyr::mutate (choices = list (NA))
demo_catvar <- demo |>
dplyr::filter (!is.na(choices)) |>
dplyr::mutate (choices = purrr::map(choices,
\(.x) unlist (strsplit(.x, split = "/"))))
demo_js <- dplyr::bind_rows(demo_strvar, demo_catvar)
demoJSON <- jsonlite::toJSON(demo_js, pretty = TRUE)
View(dat)
View(demo_js)
if (interactive()) {
dat <- tibble::as_tibble (read.csv (
'../scalepool/fullScale.csv',
header = TRUE,
na.strings = "",
fill = FALSE
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE,
fill = FALSE,
na.strings = ""))
}
View(dat)
if (interactive()) {
dat <- tibble::as_tibble (read.csv (
'../scalepool/fullScale.csv',
header = TRUE,
na.strings = "",
fill = TRUE
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE,
fill = FALSE,
na.strings = ""))
}
View(dat)
if (interactive()) {
dat <- tibble::as_tibble (read.csv ('../scalepool/fullScale.csv',
header = TRUE,
na.strings = "",
fill = TRUE
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE,
fill = FALSE,
na.strings = ""))
}
View(dat)
if (interactive()) {
dat <- tibble::as_tibble (read.csv ('../scalepool/fullScale.csv',
header = TRUE,
na.strings = ""
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE,
fill = FALSE,
na.strings = ""))
}
View(dat)
if (interactive()) {
dat <- tibble::as_tibble (read.csv ('../scalepool/fullScale.csv',
header = TRUE,
na.strings = ""
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE,
fill = FALSE,
na.strings = ""))
}
View(dat)
if (interactive()) {
dat <- tibble::as_tibble (read.csv ('../scalepool/fullScale.csv',
header = TRUE,
na.strings = ""
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE,
fill = FALSE,
na.strings = ""))
}
View(dat)
if (interactive()) {
dat <- tibble::as_tibble (read.csv ('../scalepool/fullScale.csv',
header = TRUE,
na.strings = ""
))
} else {
dat <- tibble::as_tibble (read.csv (paste0 ("./scalepool/", quest_name),
header = TRUE,
fill = FALSE,
na.strings = ""))
}
View(dat)
readRenviron(".env")
readRenviron("../.env")
con_t <- DBI::dbConnect(
RMariaDB::MariaDB(),
host = env_server,
port = Sys.getenv('SQL_PORT'),
user = Sys.getenv('USR_NAME'),
password = Sys.getenv('DB_PASS'),
dbname = Sys.getenv('SERVER_DB_NAME'))
env_server <- '127.0.0.1'
con_t <- DBI::dbConnect(
RMariaDB::MariaDB(),
host = env_server,
port = Sys.getenv('SQL_PORT'),
user = Sys.getenv('USR_NAME'),
password = Sys.getenv('DB_PASS'),
dbname = Sys.getenv('SERVER_DB_NAME'))
con_t <- DBI::dbConnect(
RMariaDB::MariaDB(),
host = env_server,
port = Sys.getenv('SQL_PORT'),
user = Sys.getenv('USR_NAME'),
password = Sys.getenv('DB_PASS'),
dbname = "fullScale")
response <- tbl (con_t, "response") |> collect()
??collect
library(tidyverse)
response <- tbl (con_t, "response") |> collect ()
View(response)
collect
demo <- tbl (con_t, "response") |> dplyr::collect ()
View(demo)
View(demo)
demo <- tbl (con_t, "demo") |> dplyr::collect ()
View(demo)
nchar(demo$property[1])
?substr
substr("abcdef", 2, 4)
demo <- tbl (con_t, "demo") |> dplyr::collect () |>
dplyr::mutate (property = substr (property, 2, nchar(property) - 1))
??pivot_longer
??pivot_wider
demo <- tbl (con_t, "demo") |> dplyr::collect () |>
dplyr::mutate (property = substr (property, 2, nchar(property) - 1)) |>
tidyr::pivot_wider(names_from = property,
values_from = value)
demo <- tbl (con_t, "demo") |> dplyr::collect () |>
dplyr::mutate (property = substr (property, 2, nchar(property) - 1))
demo <- tbl (con_t, "demo") |> dplyr::collect () |>
dplyr::mutate (property = substr (property, 2, nchar(property) - 1)) |>
tidyr::pivot_wider(names_from = property,
values_from = value)
frequency <- tbl (con_t, "frequency_counter") |> dplyr::collect ()
View(frequency)
order <- tbl (con_t, "order_list") |> dplyr::collect ()
match <- tbl (con_t, "order_match") |> dplyr::collect ()
View(match)
View(order)
View(response)
dbDisconnect(con_t)
DBI::dbDisconnect(con_t)
if (!interactive()) {
mkdir(paste0("./raw_data/results/"), Sys.Date())
} else {
mkdir(paste0("../raw_data/results/"), Sys.Date())
}
if (!interactive()) {
dir.create(paste0("./raw_data/results/"), Sys.Date())
} else {
dir.create(paste0("../raw_data/results/"), Sys.Date())
}
if (!interactive()) {
dir.create(paste0("./raw_data/results/", Sys.Date()))
} else {
dir.create(paste0("../raw_data/results/", Sys.Date()))
}
if (!interactive()) {
dir.create(paste0("./raw_data/results/", Sys.Date(), "/"))
} else {
dir.create(paste0("../raw_data/results/", Sys.Date(), "/"))
}
getwd()
if (!interactive()) {
dir.create(paste0("./raw_data/results_", Sys.Date()))
} else {
dir.create(paste0("../raw_data/results_", Sys.Date()))
}
